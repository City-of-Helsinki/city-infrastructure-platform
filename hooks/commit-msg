#!/bin/bash

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Remove Git comment lines (lines starting with #)
commit_msg_cleaned=$(echo "$commit_msg" | grep -v '^#')

# Split commit message into lines
first_line=$(echo "$commit_msg_cleaned" | head -n 1)
# Get the last non-empty line
last_line=$(echo "$commit_msg_cleaned" | sed -e '/^[[:space:]]*$/d' | tail -n 1)

has_warning=false

# Check first line format: <type>: message
if ! echo "$first_line" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?:.+"; then
    echo "WARNING: First line should follow conventional commit format:"
    echo "  <type>: <message>"
    echo "  or"
    echo "  <type>(scope): <message>"
    echo ""
    echo "Valid types: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert"
    echo ""
    echo "Your first line: $first_line"
    echo ""
    has_warning=true
fi

# Check last line format: Refs: something
if ! echo "$last_line" | grep -qE "^Refs:.+"; then
    echo "WARNING: Last line should contain 'Refs:' followed by a reference"
    echo "  Example: Refs: #123"
    echo ""
    echo "Your last line: $last_line"
    echo ""
    has_warning=true
fi

if [ "$has_warning" = true ]; then
    echo "Commit will proceed despite warnings."
    echo ""
fi

exit 0
